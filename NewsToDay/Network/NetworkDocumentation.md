# Документация: Как пользоваться сетевым слоем

Этот сетевой слой предназначен для того, чтобы отправлять запросы в интернет и получать ответы, например, получать новости или изображения. Если ты никогда не работал с сетевыми запросами, эта документация поможет тебе начать.

## 1. Что такое сетевой запрос?

Сетевой запрос — это сообщение, которое приложение отправляет в интернет, чтобы получить какие-то данные (в нашем случае - новости). После отправки запроса мы ждем ответ, который можем использовать в приложении.

## 2. Основные части сети

Созданная структура поможет тебе отправлять запросы и получать ответы. Вот ключевые моменты:

- **Запросы** — это запросы данных с сервера.
- **Ответы** — это данные, которые ты получаешь с сервера.
- **Кодировка и декодировка** — это процесс превращения данных в текст и обратно.

## 3. Как все устроено?

У нас есть несколько частей, которые работают вместе:
1. **`DataRequest`** — это общая инструкция для всех типов запросов. Каждый запрос должен знать, куда (URL) он идет, что он хочет получить (метод запроса), и как обработать ответ (декодирование).
2. **`DefaultNetworkService`** (в NewsNetworkService) — это служба, которая берет запрос и отправляет его в интернет. Она также получает ответ и передает его обратно тебе.

## 4. Простой пример запроса новостей

### Шаг 1: Создаем запрос

Чтобы отправить запрос на сервер и получить новости, нужно сначала создать запрос. Для этого у нас есть специальная структура — `TopHeadlinesRequest`. 

```
let request = TopHeadlinesRequest(category: someCategory, page: 1)
```

### Шаг 2: Отправляем запрос

Теперь, когда у нас есть запрос, мы можем его отправить через нашу службу сети (`DefaultNetworkService`).

```
let service = DefaultNetworkService()

service.request(request) { result in
    switch result {
    case .success(let articles):
        print("Мы получили \(articles?.count ?? 0) новостей.")
    case .failure(let error):
        print("Произошла ошибка: \(error.localizedDescription)")
    }
}
```

### Что происходит?
1. Мы создали запрос `TopHeadlinesRequest`, который хочет получить новости по определенной категории.
2. Мы используем `DefaultNetworkService`, чтобы отправить запрос и получить ответ.
3. Если все прошло успешно, мы получаем новости и выводим их количество.
4. Если произошла ошибка, мы выводим сообщение об ошибке.

## 5. Как загрузить картинку?

Для загрузки картинок мы используем `ImageClient`. Он может скачать изображение по URL и сохранить его в кэш, чтобы потом быстро его показывать.

### Пример загрузки изображения:
```
    private func loadImage(from url: String) {
        ImageClient.shared.setImage(from: url, placeholderImage: nil) { [weak self] image in
            DispatchQueue.main.async {
                self?.imageView.image = image
            }
        }
    }
```

### Что происходит?
1. Мы передаем URL изображения.
2. Если изображение загружено, оно показывается в приложении.

## 6. Работа с избранным (сохранение новостей)

Если нужно сохранить новость в "избранное", чтобы потом к ней вернуться, можно использовать `PersistenceManager`. Он сохраняет новости в память устройства.

### Как добавить новость в избранное:

```
PersistenceManager.shared.updateWith(bookmark: someNews, actionType: .add) { error in
    if let error = error {
        print("Ошибка добавления в избранное: \(error.rawValue)")
    } else {
        print("Новость успешно добавлена в избранное.")
    }
}
```

### Как получить список избранных новостей:

```
PersistenceManager.shared.retreiveNews { result in
    switch result {
    case .success(let bookmarks):
        print("Избранные новости: \(bookmarks.count)")
    case .failure(let error):
        print("Ошибка получения избранных новостей: \(error.rawValue)")
    }
}
```

## 7. Обработка ошибок

При работе с интернетом могут возникнуть ошибки. Например, неправильный ключ API или проблема с сервером. Для этого у нас есть специальный список ошибок в `NewsError`. Когда происходит ошибка, ты можешь понять, в чем проблема, и вывести соответствующее сообщение.

### Пример:
```
switch someError {
case .apiKeyInvalid:
    print("Неправильный API-ключ.")
case .parameterInvalid:
    print("Неправильные параметры.")
default:
    print("Неизвестная ошибка.")
}
```
